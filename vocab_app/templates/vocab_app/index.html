{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Semantic Galaxy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Outfit:wght@600&family=Sarabun:wght@300;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'vocab_app/style.css' %}">
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>
    <div id="container"></div>

    {{ is_guest|json_script:"is-guest" }}

    <div id="preview-banner" class="preview-banner hidden">
        <span>You are in <strong>Preview Mode</strong>. Register to save your progress and access all features!</span>
        <a href="{% url 'signup' %}" class="btn-register">Create Account</a>
    </div>

    <div class="overlay">

        <div class="top-bar">
            <div class="header-row">
                <div class="brand">
                    <h1 class="app-title">Semantic Galaxy</h1>
                </div>

                <div class="header-actions">
                    <div class="search-glass-panel">
                        <input type="text" id="search-input" placeholder="Search...">
                    </div>

                    <div class="auth-section">
                        {% if user.is_authenticated %}
                        <div class="user-profile-dropdown" id="user-dropdown-toggle">
                            <div class="avatar-placeholder">{{ user.username|slice:":1"|upper }}</div>
                            <span class="user-name-desktop">{{ user.username }}</span>
                            <div class="dropdown-menu hidden" id="user-dropdown-menu">
                                <span class="dropdown-item user-info-mobile">Hi, {{ user.username }}</span>
                                <a href="{% url 'logout' %}" class="dropdown-item logout-link">Logout</a>
                            </div>
                        </div>
                        {% else %}
                        <div class="auth-guest-buttons">
                            <a href="{% url 'login' %}" class="btn-login-minimal">Login</a>
                            <a href="{% url 'signup' %}" class="btn-signup-compact">Sign Up</a>
                        </div>
                        {% endif %}
                    </div>

                    <button id="mobile-menu-toggle" class="mobile-toggle" aria-label="Toggle Menu">
                        <span class="hamburger"></span>
                    </button>
                </div>
            </div>

            <div class="controls-group" id="controls-group">
                <div class="glass-panel">
                    <select id="cluster-filter">
                        <option value="all">All Clusters</option>
                    </select>
                </div>
                <div class="glass-panel">
                    <select id="type-filter">
                        <option value="all">All Types</option>
                        <option value="Verbe">Verbe</option>
                        <option value="Nom">Nom</option>
                        <option value="Adjectif">Adjectif</option>
                        <option value="Adverbe">Adverbe</option>
                        <option value="Pronom">Pronom</option>
                    </select>
                </div>
                <div class="glass-panel">
                    <select id="add-date-filter">
                        <option value="all">Add Date: All</option>
                        <option value="today">Today</option>
                        <option value="week">Last 7 Days</option>
                        <option value="month">Last 30 Days</option>
                    </select>
                </div>
                <div class="glass-panel">
                    <select id="review-date-filter">
                        <option value="all">Reviewed: All</option>
                        <option value="today">Today</option>
                        <option value="week">Last 7 Days</option>
                        <option value="month">Last 30 Days</option>
                        <option value="never">Never Reviewed</option>
                    </select>
                </div>
                <div class="glass-panel">
                    <select id="srs-level-filter">
                        <option value="all">SRS: All</option>
                        <option value="0">Level 0 (New)</option>
                        <option value="1-3">Level 1-3 (Learning)</option>
                        <option value="4-6">Level 4-6 (Knowing)</option>
                        <option value="7+">Level 7+ (Mastered)</option>
                    </select>
                </div>

                <button id="btn-add-word">+ Add Word</button>
                <button id="btn-suggest" class="secondary">Suggestions</button>
                <button id="btn-quiz" class="quiz-btn">ğŸ§  Quiz</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-flashcard" class="modal-overlay">
        <div class="modal flashcard">
            <div id="flashcard-content">
                <!-- Dynamic Content -->
            </div>
            <button onclick="closeModal('modal-flashcard')" style="margin-top: 20px;">Close</button>
        </div>
    </div>

    <div id="modal-add-word" class="modal-overlay">
        <div class="modal">
            <button class="modal-close-btn" onclick="closeModal('modal-add-word')" title="Close">&times;</button>
            <h2>Add New Word</h2>

            <!-- Step 1: Input -->
            <div id="add-step-input">
                <input type="text" id="add-thai" placeholder="Thai word (e.g. à¸›à¸¥à¹ˆà¸­à¸¢)">
                <input type="text" id="add-french" placeholder="French translation">
                <input type="text" id="add-sentence" placeholder="Example sentence (optional)">
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="btn-generate-preview" style="flex: 1;">Generate Info</button>
                    <button onclick="closeModal('modal-add-word')" class="secondary">Cancel</button>
                </div>
            </div>

            <!-- Step 2: Review & Edit -->
            <div id="add-step-review" class="hidden">
                <div class="review-fields">
                    <label>Romanization</label>
                    <input type="text" id="review-romanization">

                    <label>Word Type</label>
                    <input type="text" id="review-word-type">

                    <label>French Sentence</label>
                    <input type="text" id="review-french-sentence">

                    <label>Thai Sentence</label>
                    <input type="text" id="review-thai-sentence">

                    <label>Sentence Romanization</label>
                    <input type="text" id="review-sentence-romanization">

                    <label>Components (Thai parts, comma-separated)</label>
                    <input type="text" id="review-components-parts" placeholder="e.g. à¸™à¹‰à¸³, à¸œà¸¶à¹‰à¸‡">

                    <label>Components (French translations, comma-separated)</label>
                    <input type="text" id="review-components-trans" placeholder="e.g. eau, abeille">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="btn-back-to-input" class="secondary">â† Back</button>
                    <button id="btn-confirm-add" style="flex: 1;">Confirm & Add</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-suggestions" class="modal-overlay">
        <div class="modal">
            <button class="modal-close-btn" onclick="closeModal('modal-suggestions')" title="Close">&times;</button>
            <h2 id="suggestions-title">AI Suggestions</h2>
            <div id="suggestions-list" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Suggestions will appear here -->
                <p>Loading intelligent suggestions...</p>
            </div>
            <button onclick="closeModal('modal-suggestions')" class="secondary">Close</button>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="modal-quiz" class="modal-overlay">
        <div class="modal quiz-modal">
            <button class="modal-close-btn" onclick="requestCloseQuiz()" title="Close">&times;</button>

            <!-- Step 1: Setup -->
            <div id="quiz-step-setup">
                <h2>ğŸ§  Quiz Setup</h2>
                <div class="quiz-setup-section">
                    <label class="quiz-setup-label">Number of words</label>
                    <div class="quiz-slider-row">
                        <input type="range" id="quiz-count" min="3" max="20" value="10" class="quiz-slider">
                        <span id="quiz-count-display" class="quiz-count-badge">10</span>
                    </div>
                </div>
                <div class="quiz-setup-section">
                    <label class="quiz-setup-label">Quiz Types</label>
                    <div class="quiz-type-grid">
                        <label class="quiz-type-option">
                            <input type="checkbox" value="fr2th" checked> ğŸ‡«ğŸ‡·â†’ğŸ‡¹ğŸ‡­ French to Thai
                        </label>
                        <label class="quiz-type-option">
                            <input type="checkbox" value="th2fr" checked> ğŸ‡¹ğŸ‡­â†’ğŸ‡«ğŸ‡· Thai to French
                        </label>
                        <label class="quiz-type-option">
                            <input type="checkbox" value="audio" checked> ğŸ”Š Audio Recall
                        </label>
                        <label class="quiz-type-option">
                            <input type="checkbox" value="sentence" checked> ğŸ“ Sentence Fill
                        </label>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 24px;">
                    <button id="btn-start-quiz" style="flex: 1;">Start Quiz</button>
                    <button onclick="closeModal('modal-quiz')" class="secondary">Cancel</button>
                </div>
            </div>

            <!-- Step 2: Question -->
            <div id="quiz-step-question" class="hidden">
                <div class="quiz-progress-bar-container">
                    <div id="quiz-progress-bar" class="quiz-progress-bar"></div>
                </div>
                <div class="quiz-progress-text">
                    <span id="quiz-progress-label">1 / 10</span>
                    <span id="quiz-type-label" class="quiz-type-badge">ğŸ‡«ğŸ‡·â†’ğŸ‡¹ğŸ‡­</span>
                </div>
                <div id="quiz-question-prompt" class="quiz-question-prompt">
                    <!-- Question text appears here -->
                </div>
                <div id="quiz-options" class="quiz-options">
                    <!-- 4 MCQ options appear here -->
                </div>
                <!-- Self-rating (shown after answering) -->
                <div id="quiz-rating" class="quiz-rating hidden">
                    <p class="quiz-rating-label">How well did you know this?</p>
                    <div class="quiz-rating-buttons">
                        <button class="rating-btn rating-fail" data-rating="fail">ğŸ˜µ Fail</button>
                        <button class="rating-btn rating-hard" data-rating="hard">ğŸ˜“ Hard</button>
                        <button class="rating-btn rating-good" data-rating="good">ğŸ˜Š Good</button>
                        <button class="rating-btn rating-easy" data-rating="easy">ğŸŒŸ Easy</button>
                    </div>
                </div>
                <div id="quiz-continue" class="quiz-rating hidden">
                    <button id="btn-quiz-continue" class="quiz-continue-btn">âœ Continue (Don't give up!)</button>
                </div>
            </div>

            <!-- Step 3: Review -->
            <div id="quiz-step-review" class="hidden">
                <h2>ğŸ“Š Quiz Results</h2>
                <div id="quiz-score-summary" class="quiz-score-summary">
                    <!-- Score card -->
                </div>
                <div id="quiz-review-list" class="quiz-review-list">
                    <!-- Per-question review -->
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="btn-quiz-restart" style="flex: 1;">ğŸ”„ New Quiz</button>
                    <button onclick="closeModal('modal-quiz')" class="secondary">Close</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Quit Confirmation Dialog -->
    <div id="modal-quit-confirm" class="modal-overlay" style="z-index: 2500;">
        <div class="modal confirm-dialog">
            <h2>ğŸšª Quit Quiz?</h2>
            <p style="color: rgba(255,255,255,0.7); margin-bottom: 24px;">Are you sure you want to quit? Your progress
                will be lost.</p>
            <div style="display: flex; gap: 10px;">
                <button onclick="confirmQuitQuiz()" style="flex: 1; background: #ff5555;">Yes, Quit</button>
                <button onclick="cancelQuitQuiz()" class="secondary" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Word Confirmation Dialog -->
    <div id="modal-delete-confirm" class="modal-overlay" style="z-index: 2500;">
        <div class="modal confirm-dialog">
            <h2>ğŸ—‘ï¸ Delete Word?</h2>
            <p style="color: rgba(255,255,255,0.7); margin-bottom: 24px;">Are you sure you want to delete this word from
                your galaxy? This action cannot be undone.</p>
            <div style="display: flex; gap: 10px;">
                <button onclick="confirmDeleteWord()" style="flex: 1; background: #ff5555;">Yes, Delete</button>
                <button onclick="cancelDeleteWord()" class="secondary" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Reorient North Button -->
    <button id="btn-reorient" class="reorient-btn" title="Reset view to North">ğŸ§­</button>

    <!-- Component Filter Banner -->
    <div id="component-filter-banner" class="component-filter-banner hidden">
        <span id="component-filter-text"></span>
        <button id="btn-clear-component" class="component-filter-close" title="Clear filter">âœ•</button>
    </div>

    <!-- Scripts -->
    <script src="{% static 'vocab_app/renderer.js' %}" type="module"></script>
    <script src="{% static 'vocab_app/main.js' %}" type="module"></script>
</body>

</html>